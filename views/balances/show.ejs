<%- include('../partials/header'); %>

<h2>Manage Balance</h2>

<form action="/balances/<%= balance.id %>?_method=PUT" method="POST" autocomplete="off">

    <label>
        Date<br />
        <input type="date" name="date" value="<%= balanceDate %>" />
    </label>

    <br /><br />

    <label>
        Starting Balance<br />
        <input type="text" name="startingBalance" value="<%= balance.startingBalance.toFixed(2); %>" />
    </label>

    <br /><br />

    <label>
        Notes<br />
        <textarea name="notes"><%= balance.notes %></textarea>
    </label>

    <br /><br />

    <button type="submit">Update</button>
</form>

<br />

<h3>Transactions</h3>

<%
if(balance.lineItems.length > 0) { %>

<table>
    <thead>
        <tr align="left">
            <th>Item</th>
            <th>Bill</th>
            <th align="right">Amount</th>
            <th></th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        <% balance.lineItems.forEach(item => { %>
        <tr>
            <td><%= item.name %></td>
            <td><%= item.bill ? item.bill.name : null %></td>
            <td align="right">
                $<% if(item.transactionType === 'Withdrawal') { %>-<% } %><%= item.transactionAmount.toFixed(2) %>
            </td>
            <td><a href="/line-items/<%= item.id %>">Update</a></td>
            <td>
                <form action="/line-items/<%= item.id %>?_method=DELETE" method="POST" autocomplete="off">
                    <button type="submit">Delete</button>
                </form>
            </td>
        </tr>
        <% }); %>

        <tr>
            <th align="left" colspan="2">Balance</th>
            <td align="right">$<span id="running-balance"><%= runningBalance %></span></td>
            <td></td>
            <td></td>
        </tr>
    </tbody>
</table>

<br />

<%
} else { %>

<p>No transactions yet. Add one below.</p>

<%
}
%>

<a href="/balances/<%= balance.id %>/line-items/new">Add Transaction</a>

<p><a href="/dashboard">Go Back</a></p>

<%- include('../partials/footer') %>